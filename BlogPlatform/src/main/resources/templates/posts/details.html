<!doctype html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org"
	  th:replace="~{fragments/layout :: uklad(~{::title}, ~{::section})}">
<head>
	<title th:text="${post.tytul}">Szczegoly</title>
</head>
<section>
	<div class="d-flex justify-content-between align-items-start mb-3">
		<div>
			<h1 th:text="${post.tytul}">Tytul</h1>
			<p class="text-muted">
				<span th:text="${nazwyAutorow}">Autorzy</span>
				<span class="mx-2">•</span>
				<span th:text="${#temporals.format(post.utworzonoDnia, 'yyyy-MM-dd HH:mm')}">Data</span>
			</p>
		</div>
		<div class="d-flex gap-2" th:if="${czyMozeEdytowac}">
			<a class="btn btn-outline-secondary" th:href="@{/posts/{idPosta}/edit(idPosta=${post.id})}">Edytuj</a>
			<form th:action="@{/posts/{idPosta}/delete(idPosta=${post.id})}" method="post">
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
				<button class="btn btn-outline-danger" type="submit">Usun</button>
			</form>
		</div>
	</div>

	<div class="card shadow-sm mb-4">
		<div class="card-body">
			<div th:utext="${post.tresc}">Tresc</div>
		</div>
	</div>

	<div class="row g-3 mb-4">
		<div class="col-md-4">
			<div class="border rounded p-3 bg-white">
				<h6>Oceny</h6>
				<p class="mb-2" th:text="'Srednia: ' + ${#numbers.formatDecimal(post.sredniaOcena, 1, 2)}">Srednia</p>
				<form th:if="${czyZalogowany}" th:action="@{/posts/{idPosta}/ratings(idPosta=${post.id})}" method="post">
					<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
					<select class="form-select mb-2" name="wartosc">
						<option th:each="wartosc : ${#numbers.sequence(1,5)}" th:value="${wartosc}" th:text="${wartosc}"></option>
					</select>
					<button class="btn btn-primary btn-sm" type="submit">Ocen</button>
				</form>
			</div>
		</div>
		<div class="col-md-8">
			<div class="border rounded p-3 bg-white h-100">
				<h6>Kontakt z autorem</h6>
				<p class="mb-2">Masz pytanie? Napisz do autora posta.</p>
				<a class="btn btn-outline-primary btn-sm"
				   th:if="${czyZalogowany and nazwaOdbiorcy != null}"
				   th:href="@{/messages/compose(nazwaOdbiorcy=${nazwaOdbiorcy}, postId=${post.id})}">
					Wyslij wiadomosc
				</a>
			</div>
		</div>
	</div>

	<h3>Komentarze</h3>
	<div class="mb-3">
		<div class="border rounded p-3 bg-white mb-2" th:each="komentarz : ${komentarze}">
			<div class="small text-muted">
				<span th:text="${komentarz.autor.nazwaUzytkownika}">Autor</span>
				<span class="mx-2">•</span>
				<span th:text="${#temporals.format(komentarz.utworzonoDnia, 'yyyy-MM-dd HH:mm')}">Data</span>
			</div>
			<div th:text="${komentarz.tresc}">Tresc komentarza</div>
		</div>
		<div class="text-muted" th:if="${#lists.isEmpty(komentarze)}">Brak komentarzy.</div>
	</div>

	<div class="card shadow-sm" th:if="${czyZalogowany}">
		<div class="card-body">
			<h5>Dodaj komentarz</h5>
			<form th:action="@{/posts/{idPosta}/comments(idPosta=${post.id})}" method="post">
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
				<div class="mb-3">
					<textarea class="form-control" name="tresc" rows="3" required></textarea>
				</div>
				<button class="btn btn-primary" type="submit">Dodaj</button>
			</form>
		</div>
	</div>
</section>
</html>
